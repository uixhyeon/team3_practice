<!--
  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
  â•‘ í˜ì´ì§€: WorkerSettings.vue                                           â•‘
  â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
  â•‘ íƒ€ì…: í˜ì´ì§€ (Page - components í´ë”ì— ìˆì§€ë§Œ í˜ì´ì§€ë¡œ ì‚¬ìš©ë¨)       â•‘
  â•‘                                                                      â•‘
  â•‘ ì£¼ìš” ê¸°ëŠ¥:                                                           â•‘
  â•‘ - ì›Œì»¤(ê¸°ì‚¬) ì„¤ì • ë° ì •ë³´ í˜ì´ì§€                                     â•‘
  â•‘ - í”„ë¡œí•„ ì •ë³´ í‘œì‹œ (ì´ë¦„, ì—°ë½ì²˜, ì´ë©”ì¼)                            â•‘
  â•‘ - ì¼ì • ì •ë³´ ìš”ì•½ (ì˜¤ëŠ˜, ì´ë²ˆ ì£¼, ì´ë²ˆ ë‹¬ í–‰ì‚¬ ê±´ìˆ˜)                  â•‘
  â•‘ - ê¸‰ì—¬ í˜„í™© ìš”ì•½                                                     â•‘
  â•‘ - ë¡œê·¸ì•„ì›ƒ ê¸°ëŠ¥                                                      â•‘
  â•‘                                                                      â•‘
  â•‘ íŠ¹ì§•:                                                                â•‘
  â•‘ - í”„ë¡œí•„ ìˆ˜ì • í˜ì´ì§€ë¡œ ì´ë™                                          â•‘
  â•‘ - ê¸‰ì—¬ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™                                            â•‘
  â•‘ - ìº˜ë¦°ë” í˜ì´ì§€ë¡œ ì´ë™                                               â•‘
  â•‘ - JSON ë°ì´í„° ê¸°ë°˜ ì¼ì • í†µê³„ ê³„ì‚°                                    â•‘
  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-->

<template>
  <div class="pb-20">
    <div class="px-4 py-4">
      <!-- í”„ë¡œí•„ ì •ë³´ ì¹´ë“œ -->
      <div class="bg-white rounded-2xl shadow-sm p-5">
        <div class="flex items-center gap-4">
          <div class="w-20 h-20 rounded-full bg-gray-200 flex items-center justify-center overflow-hidden flex-shrink-0">
            <img v-if="userInfo.profileImage" :src="userInfo.profileImage" alt="í”„ë¡œí•„" class="w-full h-full object-cover" />
            <span v-else class="text-3xl text-gray-400">ğŸ‘¤</span>
          </div>
          <div class="flex-1">
            <div class="text-lg font-bold text-gray-900 mb-1">{{ userInfo.displayName }}</div>
            <div class="text-sm text-gray-600 mb-1">{{ userInfo.phone }}</div>
            <div class="text-sm text-gray-600">{{ userInfo.email }}</div>
          </div>
        </div>
        <div class="mt-4 text-right">
          <button @click="goToEditProfile" class="text-blue-600 text-sm font-bold">ë‚´ì •ë³´ ìˆ˜ì • ></button>
        </div>
      </div>

      <!-- ì¼ì • ì •ë³´ ì¹´ë“œ -->
      <div class="bg-white rounded-2xl shadow-sm mt-4 p-5">
        <div class="text-lg font-bold text-gray-900 mb-3">ì „ì²´ ìš´ì˜ ì¼ì •</div>
        <div class="space-y-3">
          <div class="flex justify-between items-center">
            <span class="text-sm text-gray-600">ì˜¤ëŠ˜ í–‰ì‚¬</span>
            <span class="text-base font-bold text-gray-900">{{ todayScheduleCount }}ê±´</span>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-sm text-gray-600">ì´ë²ˆ ì£¼ í–‰ì‚¬</span>
            <span class="text-base font-bold text-gray-900">{{ weekScheduleCount }}ê±´</span>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-sm text-gray-600">ì´ë²ˆ ë‹¬ í–‰ì‚¬</span>
            <span class="text-base font-bold text-gray-900">{{ monthScheduleCount }}ê±´</span>
          </div>
          <div class="flex justify-end mt-2">
            <button @click="goToCalendar" class="text-blue-600 text-sm font-bold">ìì„¸íˆ ë³´ê¸° ></button>
          </div>
        </div>
      </div>

      <!-- ê¸‰ì—¬ ì¹´ë“œ -->
      <div class="bg-white rounded-2xl shadow-sm mt-4 p-5">
        <div class="text-lg font-bold text-gray-900 mb-3">ë‚´ ê¸‰ì—¬ í˜„í™©</div>
        <div class="space-y-3">
          <div class="flex justify-between items-center">
            <span class="text-sm text-gray-600">ì˜¤ëŠ˜</span>
            <span class="text-base font-bold text-gray-900">-ì›</span>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-sm text-gray-600">ì´ë²ˆ ì£¼</span>
            <span class="text-base font-bold text-gray-900">-ì›</span>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-sm text-gray-600">ì´ë²ˆ ë‹¬</span>
            <span class="text-base font-bold text-gray-900">-ì›</span>
          </div>
          <div class="flex justify-end mt-2">
            <button @click="goToSalaryDetail" class="text-blue-600 text-sm font-bold">ìì„¸íˆ ë³´ê¸° ></button>
          </div>
        </div>
      </div>

      <!-- ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ -->
      <div class="mt-4 mb-4 flex justify-end">
        <button
          @click="handleLogout"
          class="bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 px-4 py-2 rounded-lg text-sm font-bold shadow-sm hover:shadow-md transition-all flex items-center gap-2 border border-gray-200 dark:border-gray-700"
        >
          <i class="fi fi-rr-sign-out-alt"></i>
          <span>ë¡œê·¸ì•„ì›ƒ</span>
        </button>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, computed } from "vue";
import { useAuthStore } from "@/stores/auth";
import { useRouter } from "vue-router";
import reservationsData from "@/data/reservations_2025_12.json";

const authStore = useAuthStore();
const router = useRouter();

const userInfo = ref({
  name: authStore.user?.name || "ê¹€ìš´ì „",
  displayName: "ê¹€ê¸°ì‚¬",
  phone: "010-1234-5678",
  email: "driver@example.com",
  profileImage: null,
});

const goToCalendar = () => {
  router.push({ name: "WorkerCalendar" });
};

const goToEditProfile = () => {
  router.push({ name: "WorkerEditProfile" });
};

const goToSalaryDetail = () => {
  router.push({ name: "WorkerSalaryDetail" });
};

const handleLogout = () => {
  const isConfirmed = window.confirm("ì •ë§ ë¡œê·¸ì•„ì›ƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
  if (isConfirmed) {
    authStore.logout();
    router.push("/login");
  }
};

// ì¼ì • í†µê³„ ê³„ì‚°
const today = new Date();
today.setHours(0, 0, 0, 0);

// ë‚ ì§œë³„ í–‰ì‚¬ ê·¸ë£¹í™”
const eventsByDate = computed(() => {
  const eventsMap = {};

  reservationsData.reservations.forEach((r) => {
    const eventDate = r.eventDate || (r.dropoffTime ? r.dropoffTime.split("T")[0] : null);
    if (!eventDate) return;

    const key = `${eventDate}|${r.eventName || "í–‰ì‚¬"}|${r.eventVenue || "-"}`;
    if (!eventsMap[key]) {
      eventsMap[key] = { date: eventDate };
    }
  });

  return Object.values(eventsMap);
});

// ì˜¤ëŠ˜ ì¼ì • ìˆ˜
const todayScheduleCount = computed(() => {
  const todayStr = today.toISOString().split("T")[0];
  return eventsByDate.value.filter((e) => e.date === todayStr).length;
});

// ì´ë²ˆ ì£¼ ì¼ì • ìˆ˜
const weekScheduleCount = computed(() => {
  const weekStart = new Date(today);
  weekStart.setDate(today.getDate() - today.getDay());
  const weekEnd = new Date(weekStart);
  weekEnd.setDate(weekStart.getDate() + 6);

  return eventsByDate.value.filter((e) => {
    const eventDate = new Date(e.date);
    return eventDate >= weekStart && eventDate <= weekEnd;
  }).length;
});

// ì´ë²ˆ ë‹¬ ì¼ì • ìˆ˜
const monthScheduleCount = computed(() => {
  const monthStart = new Date(today.getFullYear(), today.getMonth(), 1);
  const monthEnd = new Date(today.getFullYear(), today.getMonth() + 1, 0);

  return eventsByDate.value.filter((e) => {
    const eventDate = new Date(e.date);
    return eventDate >= monthStart && eventDate <= monthEnd;
  }).length;
});
</script>
